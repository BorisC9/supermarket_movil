<ion-header class="ion-no-border">
    <ion-toolbar>
        <ion-buttons slot="start">
            <ion-back-button defaultHref="/perfil" text="" class="back-btn"></ion-back-button>
        </ion-buttons>
        <ion-title>
            <span class="header-title-text">Mis Compras</span>
        </ion-title>
    </ion-toolbar>
</ion-header>

<ion-content>
    <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)">
        <ion-refresher-content></ion-refresher-content>
    </ion-refresher>

    @if (cargando()) {
    <div class="loading-container">
        <ion-spinner name="crescent" color="primary"></ion-spinner>
        <p>Cargando historial...</p>
    </div>
    } @else if (error()) {
    <div class="empty-state">
        <div class="empty-icon-container danger">
            <ion-icon name="alert-circle-outline"></ion-icon>
        </div>
        <h2>{{ error() }}</h2>
        <ion-button class="primary-btn" (click)="cargarHistorial()">
            Reintentar
        </ion-button>
    </div>
    } @else if (compras().length === 0) {
    <div class="empty-state">
        <div class="empty-icon-container">
            <ion-icon name="receipt-outline"></ion-icon>
        </div>
        <h2>No hay compras</h2>
        <p>AÃºn no has realizado ninguna compra</p>
        <ion-button class="primary-btn" routerLink="/productos">
            <ion-icon slot="start" name="storefront-outline"></ion-icon>
            Ir a Productos
        </ion-button>
    </div>
    } @else {
    <div class="compras-container">
        <div class="compras-header">
            <span class="compras-count">{{ compras().length }} compra{{ compras().length !== 1 ? 's' : '' }}</span>
        </div>

        @for (compra of compras(); track compra.ideVent) {
        <div class="purchase-card animate-in" (click)="verDetalleCompra(compra)">
            <div class="purchase-header">
                <div class="purchase-info">
                    <span class="purchase-number">Pedido #{{ compra.numFacturaVent }}</span>
                    <span class="purchase-date">{{ formatearFecha(compra.fechaVent) }}</span>
                </div>
                <span class="status-badge" [class]="getEstadoColor(compra.estadoVent)">
                    {{ getEstadoTexto(compra.estadoVent) }}
                </span>
            </div>

            <div class="purchase-details">
                <div class="detail-row">
                    <span>Subtotal</span>
                    <span>$/ {{ formatearPrecio(compra.subTotalVent) }}</span>
                </div>
                @if (compra.dctoSocioVent && compra.dctoSocioVent > 0) {
                <div class="detail-row discount">
                    <span>Desc. Socio</span>
                    <span>-$/ {{ formatearPrecio(compra.dctoSocioVent) }}</span>
                </div>
                }
                @if (compra.dctoEdadVent && compra.dctoEdadVent > 0) {
                <div class="detail-row discount">
                    <span>Desc. Tercera Edad</span>
                    <span>-$/ {{ formatearPrecio(compra.dctoEdadVent) }}</span>
                </div>
                }
                <div class="detail-divider"></div>
                <div class="detail-row total">
                    <span>Total</span>
                    <span>$/ {{ formatearPrecio(compra.totalVent) }}</span>
                </div>
            </div>

            <div class="purchase-footer">
                <span>Ver detalle</span>
                <ion-icon name="chevron-forward"></ion-icon>
            </div>
        </div>
        }
    </div>
    }
</ion-content>