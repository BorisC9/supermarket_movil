<ion-header class="ion-no-border">
    <ion-toolbar>
        <ion-buttons slot="start">
            <ion-back-button defaultHref="/usuario/perfil" text="" class="back-btn"></ion-back-button>
        </ion-buttons>
        <ion-title>
            <span class="header-title-text">Cambiar Contraseña</span>
        </ion-title>
    </ion-toolbar>
</ion-header>

<ion-content>
    <div class="password-container">
        <!-- Header Icon -->
        <div class="page-header">
            <div class="header-icon">
                <ion-icon name="shield-checkmark"></ion-icon>
            </div>
            <h2>Actualiza tu contraseña</h2>
            <p>Ingresa tu contraseña actual y la nueva</p>
        </div>

        <form [formGroup]="passwordForm" (ngSubmit)="cambiarPassword()">
            <!-- Contraseña Actual -->
            <div class="input-card">
                <label class="input-label">Contraseña Actual</label>
                <div class="input-group" [class.error]="getErrorMessage('passwordActual')">
                    <div class="input-icon">
                        <ion-icon name="lock-closed-outline"></ion-icon>
                    </div>
                    <ion-input formControlName="passwordActual" [type]="mostrarPasswordActual() ? 'text' : 'password'"
                        placeholder="Ingresa tu contraseña actual" class="custom-input">
                    </ion-input>
                    <button type="button" class="toggle-btn" (click)="toggleMostrarPasswordActual()">
                        <ion-icon [name]="mostrarPasswordActual() ? 'eye-off-outline' : 'eye-outline'"></ion-icon>
                    </button>
                </div>
                <span class="error-text" *ngIf="getErrorMessage('passwordActual')">
                    {{ getErrorMessage('passwordActual') }}
                </span>
            </div>

            <!-- Nueva Contraseña -->
            <div class="input-card">
                <label class="input-label">Nueva Contraseña</label>
                <div class="input-group" [class.error]="getErrorMessage('passwordNuevo')">
                    <div class="input-icon">
                        <ion-icon name="key-outline"></ion-icon>
                    </div>
                    <ion-input formControlName="passwordNuevo" [type]="mostrarPasswordNuevo() ? 'text' : 'password'"
                        placeholder="Mínimo 6 caracteres" class="custom-input">
                    </ion-input>
                    <button type="button" class="toggle-btn" (click)="toggleMostrarPasswordNuevo()">
                        <ion-icon [name]="mostrarPasswordNuevo() ? 'eye-off-outline' : 'eye-outline'"></ion-icon>
                    </button>
                </div>
                <span class="error-text" *ngIf="getErrorMessage('passwordNuevo')">
                    {{ getErrorMessage('passwordNuevo') }}
                </span>
            </div>

            <!-- Confirmar Contraseña -->
            <div class="input-card">
                <label class="input-label">Confirmar Contraseña</label>
                <div class="input-group"
                    [class.error]="getErrorMessage('passwordConfirmar') || (passwordForm.hasError('passwordsNoCoinciden') && passwordForm.get('passwordConfirmar')?.touched)">
                    <div class="input-icon">
                        <ion-icon name="checkmark-circle-outline"></ion-icon>
                    </div>
                    <ion-input formControlName="passwordConfirmar"
                        [type]="mostrarPasswordConfirmar() ? 'text' : 'password'"
                        placeholder="Repite la nueva contraseña" class="custom-input">
                    </ion-input>
                    <button type="button" class="toggle-btn" (click)="toggleMostrarPasswordConfirmar()">
                        <ion-icon [name]="mostrarPasswordConfirmar() ? 'eye-off-outline' : 'eye-outline'"></ion-icon>
                    </button>
                </div>
                <span class="error-text" *ngIf="getErrorMessage('passwordConfirmar')">
                    {{ getErrorMessage('passwordConfirmar') }}
                </span>
                <span class="error-text"
                    *ngIf="passwordForm.hasError('passwordsNoCoinciden') && passwordForm.get('passwordConfirmar')?.touched && !getErrorMessage('passwordConfirmar')">
                    Las contraseñas no coinciden
                </span>
            </div>

            <!-- Botones -->
            <div class="buttons-container">
                <ion-button class="primary-btn" expand="block" type="submit"
                    [disabled]="guardando() || passwordForm.invalid">
                    @if (guardando()) {
                    <ion-spinner name="crescent"></ion-spinner>
                    <span style="margin-left: 8px;">Guardando...</span>
                    } @else {
                    <ion-icon slot="start" name="shield-checkmark"></ion-icon>
                    Cambiar Contraseña
                    }
                </ion-button>

                <ion-button class="cancel-btn" expand="block" fill="clear" (click)="cancelar()"
                    [disabled]="guardando()">
                    Cancelar
                </ion-button>
            </div>
        </form>
    </div>
</ion-content>